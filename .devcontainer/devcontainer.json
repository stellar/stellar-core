// For format details, see https://aka.ms/vscode-remote/devcontainer.json or the definition README at
// https://github.com/devcontainers/images/blob/main/README.md
{
	"name": "Ubuntu 24.04 & Git",
	"dockerFile": "Dockerfile",
	"build": {
		"args": {
			"APT_MIRROR": "${localEnv:APT_MIRROR}"
		}
	},
	"onCreateCommand": "./install-rust.sh",
	// The optional 'runArgs' property can be used to specify additional runtime arguments.
	"runArgs": [
		// Uncomment these lines if you will use a ptrace-based debugger like C++, Go, and Rust.
		// Note that these options have security implications and should be used with caution.
		// We have them disabled currently because we don't want to allow copilot LLMs to use ptrace
		// to escape the container sandbox.
		// "--cap-add=SYS_PTRACE",
		// "--security-opt",
		// "seccomp=unconfined",

		// Uncomment the next line to use a non-root user. On Linux, this will prevent
		// new files getting created as root, but you may need to update the USER_UID
		// and USER_GID in .devcontainer/Dockerfile to match your user if not 1000.
		"-u",
		"vscode"
	],

	// We previously had `features.docker-from-docker` enabled here to allow
	// running docker commands inside the container. However we now disable that
	// as we are are using the devcontainers as a moderate-strength security
	// boundary to sandbox the copilot LLMs. We don't want them running host
	// docker commands -- that would violate the whole point of the sandbox.

	// Uncomment the next line if you want to publish any ports.
	// "appPort": [],
	// Uncomment the next line to run commands after the container is created.
	// "postCreateCommand": "uname -a",
	"customizations": {
		"vscode": {
			"settings": {
				"terminal.integrated.defaultProfile.linux": "bash",
				"clangd.path": "/usr/bin/clangd-20"
			},
			"extensions": [
				"llvm-vs-code-extensions.vscode-clangd",
				"llvm-vs-code-extensions.lldb-dap",
				"matepek.vscode-catch2-test-adapter",
				"rust-lang.rust-analyzer",
				"graydon.lsp-lm-tool"
			]
		}
	}
}